<!DOCTYPE html>
<html lang="en">
<head>
<title>AwesompleteUtil</title>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://leaverou.github.io/awesomplete/prism/prism.css"/>
<link rel="stylesheet" href="https://getbootstrap.com/dist/css/bootstrap.min.css"/>
<link rel="stylesheet" href="css/awesomplete.css"/>
<script src="js/awesomplete.min.js"></script>
<script src="js/awesomplete-util.min.js"></script>
<style>
  body { line-heigth: 150%; font-size: 18px; }

  /* style navbar */
  .logo { font-family: "Georgia, serif"; 
          color: brown; 
          font-style: italic }
  .logo span { font-style: normal }
  .navbar { background-color: #64f652 }
  @media screen and (min-width: 768px) { 
    .navbar { position: fixed; 
              top: 0;
              width: 100%;
              opacity: 0.9 }
    header { margin-top: 25px }
    header, section { padding-top: 40px }  
  }

  /* style html and javascript code blocks */
  .language-javascript,
  .language-markup { margin-top: -4em !important }
  .language-label  { text-align: right;
                     font-weight: bold; 
                     margin: 1.6em 1em;
                     color: brown }

  /* fight with bootstrap */
  .table { display: table }
  h2 { margin-left:  -15px;
       margin-right: -15px }
  thead th { text-align: center }
  td code { color: inherit;
            background-color: inherit }

  /* style awesomplete-util */
  div.awesomplete { display: block }
  .input-group-btn .dropdown-btn { line-height: 30px }
  div.awesomplete ul { font-size: smaller }
  div.awesomplete ul li p { display: block; 
                            font-size: small;
                            margin-left: 1em;
                            color: #0 }
  div.awesomplete .awe-found     { border: 2px solid green }
  div.awesomplete .awe-not-found { border: 2px solid red   }
  .hide-not-found div.awesomplete .awe-not-found { border-color: lightblue }

  /* style examples */
  .example { margin-top: 40px }
  #awe-track-artists ul { margin-top: 0 }
  .album { min-height: 200px }
  .odd  { border-right: thick ridge purple; padding-right: 6px }
  .even { border-left: thick groove purple; padding-left: 6px }
  .features { font-size: smaller;
              padding: 1em;
              margin-bottom: 2em;
              border: 3px solid green }
  .html, .js, .awe { margin-top: 2em }
  th, td { vertical-align: top }
  tbody, td { border: 1px solid black; padding: 5px 8px }

  /* style table */
  table { border-spacing: 0;
          border-collapse: collapse }
  tbody { vertical-align: top }
  td { padding: 5px 9px; 
       border: 1px solid black }

</style>
</head>
<body>

  <!-- Static navbar -->
  <nav class="navbar navbar-default navbar-static-top">
    <div class="container-fluid">
      <div class="navbar-header">
          <a class="navbar-brand logo" href="#">Awesomplete<span>Util</span></a>
      </div>
        <ul class="nav navbar-nav">
          <li><a href="#examples">Examples</a>
          <li><a href="#installation">Installation &amp; CSS style</a>
          <li><a href="#events">Events</a>
          <li><a href="#api">API</a>
        </ul>
    </div>
  </nav>
  <header class="container">
    <div class="row">
      <div class="col-sm-12">
        <span class="logo">Awesomplete<span>Util</span></span> is a javascript library enhancing Lea Verou's autocomplete / autosuggest / typeahead / inputsearch <a href="https://leaverou.github.io/awesomplete/index.html" target="awe">Awesomplete widget</a>.
        <p>
        AwesompleteUtil adds the following features:
        <ul>
          <li>Dynamic remote data loading; based on what is typed-in it performs an ajax lookup.
          <li>Allow HTML markup in the shown items. Show value with description. Optionally search in the description text.
          <li>Show when there is an exact match.
          <li>Show when there isn't a match.
          <li>When there is an exact match show related data (supplied in the remote data) in other parts of the page.
          <li>Select the highlighted item when tab-key is used.
        </ul>
        <p>
        AwesompleteUtil provides enough hooks to keep the agility which the Awesomplete widget has.
        <p>
        The only dependency of AwesompleteUtil is Awesomplete. Together it is less than 5KB minified gzipped.
        It runs on modern browsers; IE11, Edge, Safari, Android stock browser, Chrome, Firefox.
        <p>
        The lucky users of <a href="http://www.phoenixframework.org" target="phoe">Phoenix</a> can use the <a href="phoenix.html">Awesomplete form helper</a> to generate most of the javascript code. 
      </div>
    </div>
  </header>

  <section class="container" id="examples">
    <h2>Examples</h2>

    <div class="row">
      <div class="col-sm-12 html">
         <ol>
            <li><a href="#combobox">Combobox with countries</a>
            <li><a href="#user-host">Connect as user to host</a>
            <li><a href="#iso-country">Country iso code</a>
            <li><a href="#colors">Colors</a>
            <li><a href="#capital">Country capitals</a>
            <li><a href="#seafood">Seafood pizza toppings</a>
            <li><a href="#multimail">Email address</a>
            <li><a href="#spotify-track">Spotify track search</a>
            <li><a href="#spotify-artist">Spotify artist search</a>
         </ol>
      </div>
    </div>

      <!-- BEGIN combobox example -->
  <fieldset id="combobox" class="example">
    <legend class="h3">
    Combobox with countries
    </legend>
    <div class="row even">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>Combobox.
          <li>Use remote service which returns everything; load all.
        </ul>
      </div>
      <label class="control-label col-sm-2" for="user_combocountry">Country</label>
      <div class="col-sm-10 au">
         <span class="table">
            <input class="form-control" id="user_combocountry" name="user[combocountry]" type="text">
            <span class="input-group-btn">
               <button class="dropdown-btn" id="awe_btn_user_combocountry" type="button">
                  <span class="caret"></span>
               </button>
            </span>
         </span>
      </div>
    </div>
  </fieldset>

    <div class="row even">
      <div class="col-sm-12 html">
        Input control:
        <p class="language-label">HTML
        <pre class="language-markup"><code >&lt;input id="user_combocountry" class="form-control" 
     name="user[combocountry]" type="text" /&gt;
&lt;span class="input-group-btn"&gt;
   &lt;button class="dropdown-btn" id="awe_btn_user_combocountry" type="button"&gt;
      &lt;span class="caret"&gt;&lt;/span&gt;
   &lt;/button&gt;
&lt;/span&gt;</code></pre>
      </div>
      <div class="col-sm-12 awe">
        The combobox is useful when there are only a few items in the list. Here we use 8 maxItems,
        so when the combobox is opened, only the first 8 countries are shown.
        The shortest country names are shown first.
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startClick('#awe_btn_user_combocountry',
  AwesompleteUtil.start('#user_combocountry',
   {
    url: 'https://restcountries.eu/rest/v1/all', 
    loadall: true, 
    prepop: true
   }, 
   {
    minChars: 1,
    maxItems: 8,
    data: function(rec, input) { return rec['name']; }
   }
  )
);</script></code></pre>
        The prepop:true makes sure that the countries are loaded during page load.
      </div>
    </div>
  <!-- END combobox example -->

  <!-- BEGIN user_host example -->
  <fieldset id="user-host" class="example">
    <legend class="h3">
    Connect as user to host
    </legend>
    <div class="row odd">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>Type user name and get suggestions for hostnames; autocomplete after a certain character.
          <li>Show descriptions in the suggestion list.
          <li>Load suggestions from json file.
        </ul>
      </div>
      <div class="col-sm-12">
         Enter for example 'root@192.168.1.1'
      </div>
      <label class="control-label col-sm-2" for="user_host">User@host</label>
      <div class="col-sm-10 au hide-not-found">
         <input class="form-control" id="user_host" name="user[host]" type="text">
      </div>
    </div>
  </fieldset>

    <div class="row odd">
      <div class="col-sm-12 html">
        Input control:
        <p class="language-label">HTML
        <pre class="language-markup"><code >&lt;input id="user_host" class="form-control" 
     name="user[host]" type="text" /&gt;</code></pre>
      </div>
      <div class="col-sm-12 awe">
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_host',
 {
   url: 'js/host.json',
   loadall: true
 },
 {
   data: function(rec, input) {
     var data = { label: rec['value']+'<p>'+(rec['label'] || ''), value: rec['value'] }, 
       before = (input.slice(0, input.indexOf('@')) + '@').trim(); 
     return {label: before + data.label, value: before + data.value}; 
   },
   filter: AwesompleteUtil.filterStartsWith, 
   item: AwesompleteUtil.itemStartsWith
 }
);</script></code></pre>
      </div>
    </div>
  <!-- END user_host example -->

  <!-- BEGIN iso-country example -->
  <fieldset id="iso-country" class="example">
    <legend class="h3">
    Country iso code
    </legend>
    <div class="row even">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>Use remote service that doesn't return a list but a single entry to verify input.
          <li>Show related data if entry found.
          <li>Handle HTTP 404 status with custom ajax function.
        </ul>
      </div>
      <div class="col-sm-12">
         Enter for example 'usa'
      </div>
      <label class="control-label col-sm-2" for="user_country_iso">Country iso three letter code</label>
      <div class="col-sm-10 au">
          <input class="form-control" id="user_country_iso" name="user[country_iso]" autocomplete="off" type="text">
         <span id="awe-country-name"></span>
      </div>
    </div>
  </fieldset>

    <div class="row even">
      <div class="col-sm-12 html">
        This is actually not an autocomplete, but it does verify the input.
        <p class="language-label">HTML
        <pre class="language-markup"><code >&lt;input id="user_country_iso" class="form-control" autocomplete="off"
     name="user[iso-country]" type="text" /&gt;
&lt;span id="awe-country-name"&gt;&lt;/span&gt;</code></pre>
      </div>
      <div class="col-sm-12 awe">
        The remote service returns a HTTP status 404 if the searched value is not found. The default ajax
        function only processes responses with HTTP OK status 200.
        The ajax404 function below replaces the onload function to set the empty list if a 404 is received. 
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>var ajax404 = function(url, urlEnd, val, fn, xhr) {
    var awe = this;
    function onload404() {
      if (xhr.status === 404) AwesompleteUtil.load(awe, [], null);
      fn();
    }
    AwesompleteUtil.ajax(url, urlEnd, val, onload404, xhr);
  };

AwesompleteUtil.startCopy('#user_country_iso', 'name', '#awe-country-name');
AwesompleteUtil.start('#user_country_iso',
 {
  url: 'https://restcountries.eu/rest/v1/alpha/',
  limit: 0,
  ajax: ajax404
 }, 
 {
  maxItems: 0,
  minChars: 3,
  data: function(rec, input) { return rec['alpha3Code']; },
  filter: Awesomplete.FILTER_STARTSWITH
 }
);</script></code></pre>
        A limit:1 tells that not more than 1 result is expected, so the json service doesn't have to return an array. 
        With limit:0 it will always re-query if more characters are typed. 
      </div>
    </div>
  <!-- END iso-country example -->

  <!-- BEGIN colors example -->
  <fieldset id="colors" class="example">
    <legend class="h3">
    Colors
    </legend>
    <div class="row odd">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>Suggestion list with value and label as part of page source.
          <li>Label with HTML markup.
          <li>Show data of initial/autofill value; Prepopulation event during page load
        </ul>
      </div>
      <div class="col-sm-12">
         Enter a color:
      </div>
      <label class="control-label col-sm-2" for="user_color">Color</label>
      <div class="col-sm-10 au">
         <input id="user_color" class="form-control" name="user[color]" value="purple" type="text">
      </div>
      <div class="col-sm-2 text-right"><span id="awe-color-result"></span> &#x21B2;</div>
    </div>
  </fieldset>

    <div class="row odd">
      <div class="col-sm-12 html">
        Input control:
        <p class="language-label">HTML
        <pre class="language-markup"><code>&lt;input id="user_color" class="form-control" 
     name="user[color]" type="text" value="purple" /&gt;
&lt;div&gt;&lt;span id="awe-color-result"&gt;&lt;/span&gt; &amp;#x21B2;&lt;/div&gt;</code></pre>
      </div>
      <div class="col-sm-12 awe">
        Below the Awesomplete object is created 
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startCopy('#user_color', 'label', '#awe-color-result');
AwesompleteUtil.start('#user_color', 
 {
  prepop: true
 }, 
 { 
  list: [
    { label: "<b style='color:black'>black</b>",   value: 'black' },
    { label: "<b style='color:blue'>blue</b>",     value: 'blue'  },
    { label: "<b style='color:brown'>brown</b>",   value: 'brown' },
    { label: "<b style='color:green'>green</b>",   value: 'green' },
    { label: "<b style='color:orange'>orange</b>", value: 'orange'},
    { label: "<b style='color:pink'>pink</b>",     value: 'pink'  },
    { label: "<b style='color:purple'>purple</b>", value: 'purple'},
    { label: "<b style='color:red'>red</b>",       value: 'red'   },
    { label: "<b style='color:yellow'>yellow</b>", value: 'yellow'}
  ], 
  minChars: 1, 
  filter: AwesompleteUtil.filterContains
 }
);</script></code></pre>
      Notice the prepop property and the startCopy function call. The initial/autofilled value of input-control triggers the copy action, and the label is copied to the span-tag with id 'awe-color-result' during page load. The order of the html elements and the inline script is important here. The startCopy function must be called before the startAwesomplete function, because the latter can immediately fire the 'awesomplete-prepop' event which should be handled by the former.
The startCopy inline script should preferable be placed after the HTML element which is the target. If you do, it only has to lookup the target element once, but If you don't do this it will lookup the target element with each event.
<p>
If you use remote data loading and combine prepop:true with loadall:true the remote call will happen during page load. If prepop:false, the loadall will be done lazely, e.g. if the user makes changes and the input size >= minChars.
      </div>
    </div>
  <!-- END colors example -->

  <!-- BEGIN capital example -->
  <fieldset id="capital" class="example">
    <legend class="h3">
    Country capitals
    </legend>
    <div class="row even">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>One remote call (load all) resulting in one response list shared by multiple controls.
          <li>Copy related data of selected item to other input field, in two directions!
        </ul>
      </div>
      <div class="col-sm-12">
          Enter either country or capital, and look what happens in the other field.
      </div>
      <label class="control-label col-sm-2" for="user_country">Country</label>
      <div class="col-sm-4 au">
         <input id="user_country" class="form-control" name="user[country]" autocomplete="off" type="text">
      </div>
      <label class="control-label col-sm-2" for="user_capital">Capital</label>
      <div class="col-sm-4 au">
         <input id="user_capital" class="form-control" name="user[capital]" autocomplete="off" type="text">
      </div>
    </div>
  </fieldset>

    <div class="row even">
      <div class="col-sm-12 html">
        Input controls:
        <p class="language-label">HTML
        <pre class="language-markup"><code>&lt;input id="user_country" class="form-control" name="user[country]" autocomplete="off" type="text" /&gt;
&lt;input id="user_capital" class="form-control" name="user[capital]" autocomplete="off" type="text" /&gt;</code></pre>
      </div>
      <div class="col-sm-12 awe">
        Below the Awesomplete objects are created 
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startCopy('#user_country', 'capital', '#user_capital');
AwesompleteUtil.startCopy('#user_capital', 'name', '#user_country');
var awe_user_country=AwesompleteUtil.start('#user_country', 
 {}, 
 {
  minChars: 1, 
  maxItems: 7, 
  data: function(rec, input) { return rec['name']; }
 }
);

var awe_user_capital=AwesompleteUtil.start('#user_capital', 
 {}, 
 {
  minChars: 1, 
  maxItems: 7, 
  data: function(rec, input) { return rec['capital']; }
 }
);

AwesompleteUtil.ajax('https://restcountries.eu/rest/v1/all', '', '', 
  function(e) {
    var xhr = this, list;
    if (xhr.status === 200) {
      list = JSON.parse(xhr.responseText);
      AwesompleteUtil.load(awe_user_country, list, true);
      AwesompleteUtil.load(awe_user_capital, list, true);
    }
   }
);</script></code></pre>
      </div>
    </div>
  <!-- END capital example -->

  <!-- BEGIN seafood example -->
  <fieldset id="seafood" class="example">
    <legend class="h3">
    Seafood pizza toppings
    </legend>
    <div class="row odd">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>Data list in page source.
          <li>Select multiple items.
        </ul>
      </div>
      <div class="col-sm-12">
         Enter for example 'Crayfish, Oysters'
      </div>
      <label class="control-label col-sm-2" for="user_seafood">Seafood toppings</label>
      <div class="col-sm-10 au">
         <input class="form-control" id="user_seafood" name="user[seafood]" type="text"
          data-list="Anchovies, Cajun Prawn, Crayfish, Lobster, Oysters, Prawns, Salmon, Shrimps, Smoked Salmon, Squid, Tuna, Whitebait">
      </div>
    </div>
  </fieldset>

    <div class="row odd">
      <div class="col-sm-12 html">
        Input control with data-list:
        <p class="language-label">HTML
        <pre class="language-markup"><code >&lt;input id="user_seafood" class="form-control" 
     name="user[seafood]" type="text" 
  data-list="Anchovies, Cajun Prawn, Crayfish, Lobster,
             Oysters, Prawns, Salmon, Shrimps,
             Smoked Salmon, Squid, Tuna, Whitebait"&gt;</code></pre>
      </div>
      <div class="col-sm-12 awe">
        Notice that you can enter multiple toppings, seperated by , or ;
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_seafood',
 {
  convertInput: function(input) { return input.replace(/[,;]\s*$/, '').match(/[^,;]*$/)[0].trim().toLowerCase(); }
 },
 {
  minChars: 1, 
  replace: function(data) { 
    var text=data.value; 
    this.input.value = this.input.value.match(/^.+[,;]\s*|/)[0] + text + ', ';
  },
  filter: function(data, input) {
    return Awesomplete.FILTER_CONTAINS(data, input.match(/[^,;]*([,;]\s*)?$/)[0]);
  },
  item: function(text, input) {
    return AwesompleteUtil.itemContains(text, input.match(/[^,;]*([,;]\s*)?$/)[0]); 
  }
 }
);</script></code></pre>
        The regular expressions are used to extract the last part of the input from the rest.
      </div>
    </div>
  <!-- END seafood example -->


  <!-- BEGIN multimail example -->
  <fieldset id="multimail" class="example">
    <legend class="h3">
    Email address
    </legend>
    <div class="row even">
      <div class="col-xs-11 col-xs-offset-1 features">
        Example demonstrates:
        <ul>
          <li>In the shown suggestions the email address is shown below the name. The value contains both.
          <li>Multiple input values.
          <li>Load suggestions from json file.
        </ul>
      </div>
      <div class="col-sm-12">
         Enter an email address (they are all from acme.com):
      </div>
      <label class="control-label col-sm-2" for="user_multimail">Email</label>
      <div class="col-sm-10 au">
         <input class="form-control" id="user_multimail" name="user[multimail]" type="text">
      </div>
    </div>
  </fieldset>

    <div class="row even">
      <div class="col-sm-12 html">
        Input control:
        <p class="language-label">HTML
        <pre class="language-markup"><code >&lt;input id="user_multimail" class="form-control"
     name="user[multimail]" type="text" /&gt;</code></pre>
      </div>
      <div class="col-sm-12 js">
          This examples uses a <a href="http://uinames.com/api/" target=_blank>random name service</a>.
        saved in the 'js/uinames.json' file.
        The uinames2contacts function below constructs email addresses and a value that contains both name and email address.
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>var uinames2contacts = function(names) {
  var email_result = {},
      result_list = [],
      transform_names = function(item) {
        var contact = {};
        contact.name = item.name + ' ' + item.surname;
        contact.email = item.name.toLowerCase() + '.' + 
                        item.surname.toLowerCase() + '@acme.com';
        contact.value = contact.name + ' <' + contact.email + '>';
        result_list.push(contact);
      };
  names.forEach(transform_names);
  email_result.contacts = result_list;
  return email_result;
};</script></code></pre>
      </div>
      <div class="col-sm-12 awe">
        In this example the 'value' field contains both name and email address.
        By default only the matching text in the first line of the label is highlighted. 
        The itemMarkAll function highlights all matching text in the suggestion list.
        Try for example to search on '@acme.com' to see what it highlights with or without this function. 
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_multimail',
 { 
  url: 'js/uinames.json',
  convertResponse: uinames2contacts,
  loadall: true,
  convertInput: function(input) {
    return input.replace(/[;,]\s*$/, '').match(/[^;,]*$/)[0].trim().toLowerCase();
  }
 }, 
 {
  minChars: 1,
  maxItems: 7,
  data: function(rec, input) { 
    return { label: (rec['name'] || '').replace('<p>', '<p >')+'<p>'+(rec['email'] || ''),
             value: rec['value'] };
  }, 
  replace: function(data) { 
    var text=data.value; this.input.value = this.input.value.match(/^.+[;,]\s*|/)[0] + text + '; ';
  }, 
  filter: function(data, input) { 
    return Awesomplete.FILTER_CONTAINS(data.value, input.match(/[^;,]*([;,]\s*)?$/)[0]); 
  }, 
  item: function(text, input) { 
    return (AwesompleteUtil.itemMarkAll)(text, input.match(/[^;,]*([;,]\s*)?$/)[0]); 
  }
 }
);</script></code></pre>
        The regular expressions are used to extract the last part of the input from the rest.
      </div>
    </div>
  <!-- END multimail example -->

      <!-- BEGIN spotify track example -->
      <fieldset id="spotify-track" class="example">
        <legend class="h3">
        Spotify track search
        </legend>
        <div class="row odd">
          <div class="col-xs-11 col-xs-offset-1 features">
            Example demonstrates:
            <ul>
              <li>Dynamic data loading.
              <li>Show related data of selected item.
              <li>Custom render functions for copy action.
            </ul>
          </div>
          <div class="col-sm-12">
             Unfortunately since June 2016 an API key is needed, so the live demo doesn't work anymore.
          </div>
          <label class="control-label text-right col-sm-2" for="user_track1">Track</label>
          <div class="col-sm-10 au">
            <input id="user_track1" class="form-control" autocomplete="off" name="user[track1]" type="text">
          </div>
        </div>
        <div class="row odd artists">
           <label class="control-label text-right col-sm-2">Artists</label>
           <div class="col-sm-10" id="awe-track-artists"></div>
        </div>
        <div class="row odd album"> 
           <label class="control-label text-right col-sm-2">Album</label>
           <div class="col-sm-3" id="awe-track-album"></div>
           <div class="col-sm-7" id="awe-track-album-img"></div>
        </div>
      </fieldset>

        <div class="row odd">
          <div class="col-sm-12 html">
            <p class="language-label">HTML
            <pre class="language-markup"><code >&lt;input id="user_track1" class="form-control" autocomplete="off" 
         name="user[track1]" type="text" /&gt;</code></pre>
          </div>
          <div class="col-sm-12 js">
            The artistsFun function below shows the artists of the selected track as list items.
            The albumImgFun function displays an image of the album of the selected track. These functions are used by the startCopy methods. 
            <p class="language-label">Javascript
            <pre class="language-javascript"><code><script>var artistsFun = function(e, dataField) { 
       var arrArtists = e.detail.length === 1 ? e.detail[0][dataField] : [],
           html = '', 
           i; 
       for (i=0; i < arrArtists.length; i++) {
         html = html + '<li>' + arrArtists[i].name;
       } 
       Awesomplete.$('#awe-track-artists').innerHTML = '<ul>' + html + '</ul>'; 
    };

    var albumImgFun = function(e, dataField) {
       var arrImages = e.detail.length === 1 ? e.detail[0][dataField] : [],
           html = ''; 
       if (arrImages.length > 0) {
         html = '<img src="' + arrImages[0].url + '" alt="album image" width="200"/>';
       }  
       Awesomplete.$('#awe-track-album-img').innerHTML = html;
    };

    AwesompleteUtil.startCopy('#user_track1', 'album.name', '#awe-track-album');
    AwesompleteUtil.startCopy('#user_track1', 'artists',      artistsFun);
    AwesompleteUtil.startCopy('#user_track1', 'album.images', albumImgFun);</script></code></pre>
          </div>
          <div class="col-sm-12 js">
            The creation of the Awesomplete object below is almost the same as in the 'spotify artist search' example.
            <p class="language-label">Javascript
            <pre class="language-javascript"><code><script>
    AwesompleteUtil.start('#user_track1', 
     {
      url: 'https://api.spotify.com/v1/search?type=track&limit=10&q=track:', 
      urlEnd: '*', 
      limit: 10, 
      convertResponse: AwesompleteUtil.jsonFlatten.bind({value: 'name'})
     },
     {
      minChars: 4, 
      data: function(rec, input) { 
             return { 
               label: rec['name']+'<p>'+(rec['album.name'] || ''), 
               value: rec['name'] 
              }; 
            }, 
      filter: filterWords,
      item: itemWords
     }
    );</script></code></pre>
      Unfortunetly we cannot instruct to Spotify to sort on song title length. If you search for songs with only one or
      two words, it might be that the desired song is not in the first 10 shown results.
          </div>
        </div>
      <!-- END spotify track example -->

      <!-- BEGIN spotify artist example -->
      <fieldset id="spotify-artist" class="example">
        <legend class="h3">
        Spotify artist search.
        </legend>
        <div class="row even">
          <div class="col-xs-11 col-xs-offset-1 features">
            Example demonstrates:
            <ul>
              <li>Dynamic data loading.
              <li>Flatten json.
              <li>Custom search filter.
              <li>Custom text highlighter.
            </ul>
            Obviously we cannot load all artists known by spotify in the browsers memory, so that's why we use here
            dynamic data loading. The search starts if 3 characters are entered.
          </div>
          <div class="col-sm-12">
             Unfortunately since June 2016 an API key is needed, so the live demo doesn't work anymore.
          </div>
          <label class="control-label col-sm-2" for="user_artist1">Artist</label>
          <div class="col-sm-10 au">
             <input class="form-control" id="user_artist1" name="user[artist1]" type="text">
          </div>
        </div>
      </fieldset>

        <div class="row even">
          <div class="col-sm-12 html">
            Nothing unusal in the input control:
            <p class="language-label">HTML
            <pre class="language-markup"><code >&lt;input class="form-control" id="user_artist1" name="user[artist1]" type="text" /&gt;</code></pre>
          </div>
          <div class="col-sm-12 js">
            The standard supplied 'starts-with' and 'contains' filters don't exactly match with how Spotify searches (Elasticsearch).
            Spotify searches words, you can search for 'Michael Jackson' or 'Jackson Michael' and get the same results.
            Thats why a custom filter called 'filterWords' is used that filters on the words entered. To highlight the
            words in the list of suggestions a custom function called 'itemWords' is used.
            <p class="language-label">Javascript
            <pre class="language-javascript"><code><script>
      var filterWords = function(data, input) {
        var words = input.split(/\s+/), result = true, j;
        /* iterate words */
        for (j = 0; result && j < words.length; j++) {
          /* all entered words must be found */
          result = Awesomplete.FILTER_CONTAINS(data, words[j]); 
        }
        return result;
      },
      itemWords = function(text, input) {
        var arr, words = input.split(/\s+/), j;
        if (input.trim() !== '') {
          /* Label contains value and optional extra HTML markup 
             which starts with the <p> tag. 
             Do not mark text after the first <p> */
          arr = ('' + text).split('<p>');
          /* iterate words */
          for (j = 0; j < words.length; j++) {
            /* highlight word with <mark> </mark> tags */
            arr[0] = AwesompleteUtil.mark(arr[0], words[j]);
          }
          text = arr.join('<p>');           
        } 
        return AwesompleteUtil.item(text, input);
      };</script></code></pre>
          </div>
          <div class="col-sm-12 awe">
            Below the Awesomplete object is created with the filter and item functions defined above.
            The '*' wildcard character is added at the end of the remote url.
            A limit of 15 is specified; if 15 or more results are returned by the server the code assumes that there
            are more results, so it will re-query if more characters are typed to get more refined results.
            <p class="language-label">Javascript
            <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_artist1',
 {  /* util options */
  url: 'https://api.spotify.com/v1/search?type=artist&limit=15&q=artist:', 
  urlEnd: '*', 
  limit: 15, 
  convertResponse: AwesompleteUtil.jsonFlatten.bind({value: 'name'})
 }, 
 {  /* awesomplete options */
  minChars: 3,
  filter: filterWords,
  item: itemWords
 }
);</script></code></pre>
            Look at the convertResponse property.
            AwesompleteUtil accepts a JSON response object with an array of objects to feed the list of suggestions, e.g.
            something like:<pre><code>{ "artists":[ "Adele", "U2" ] }</code></pre>However Spotify returns a deeper structure.
            The jsonFlatten function flattens JSON:<p><code>{ "a":{"b":{"c":[{"d":{"e":1}}]}}}</code> becomes <code>{"a.b.c":[{"d.e":1}]}</code>.
            <p>
            You can pass on extra options via the bind method. 
            Awesomplete by default accepts strings or objects with 'value' and 'label' properties.
            In the example it's specified that within the array, the 'name' property should also be added as 'value' property and implicitly also as 'label' property.
          </div>
        </div>
      <!-- END spotify artist example -->

  </section>
  <section class="container" id="installation"> 
    <h2>Installation &amp; CSS style</h2>
    <div class="row">
      <div class="col-sm-12">
         <h3>Installation</h3>
         In the header of your HTML page add:
         <p class="language-label">HTML
         <pre class="language-markup"><code >&lt;link rel="stylesheet" href="https://nico-amsterdam.github.io/awesomplete-util/css/awesomplete.css"&gt;
&lt;script src="https://nico-amsterdam.github.io/awesomplete-util/js/awesomplete.min.js"&gt;&lt;/script&gt;
&lt;script src="https://nico-amsterdam.github.io/awesomplete-util/js/awesomplete-util.min.js"&gt;&lt;/script&gt;
&lt;style&gt;
  div.awesomplete { display: block }

  div.awesomplete ul li p { display: block; font-size: small; margin-left: 1em }

  div.awesomplete .awe-found { border: 2px solid green }

  .hide-not-found div.awesomplete .awe-not-found { border-color: lightblue }

  div.awesomplete .awe-not-found { border: 2px solid red }

&lt;/style&gt;</code></pre>
         The awesomplete.css and awesomplete.min.js files are copied from <a href="https://github.com/LeaVerou/awesomplete" target="awe">Awesomplete</a> and tested in combination with AwesompleteUtil. If you copy these files to your own project, do not forget to also copy the javascript sourcemaps (<a href="https://nico-amsterdam.github.io/awesomplete-util/js/awesomplete.min.js.map" target=_blank>awesomplete.min.js.map</a> and <a href="https://nico-amsterdam.github.io/awesomplete-util/js/awesomplete-util.min.js.map" target=_blank>awesomplete-util.min.js.map</a>).
         <p>
         <h3>CSS Style</h3>
         Customize the above styling for your own needs. The CSS class 'awe-found' is put on the input control when the input exactly matches the value of an list item. The CSS class 'awe-not-found' is put on the input control when the list closes because there are no more matching items.
     </div>
    </div>
  </section>

  <section class="container" id="events"> 
    <h2>Events</h2>
    <div class="row">
      <div class="col-sm-12">
         <a href="https://leaverou.github.io/awesomplete/index.html#events" target="awe">Events triggered by Awesomplete</a>. AwesompleteUtil adds these events:
         <table>
           <thead>
             <tr>
               <th>Event name
               <th>Description
             </tr>
           </thead>
           <tbody>
             <tr>
                <td>awesomplete-loadcomplete
                <td>Fired when a new list is assigned to Awesomplete after a succesful ajax call. The event detail property contains the input value that triggered the ajax call. 
             <tr>
                <td>awesomplete-match
                <td>Fired when a new input value is compared with the item list. The event detail property contains an array with the matching list item(s). The array is empty when there is no match.
             <tr>
                <td>awesomplete-prepop
                <td>Fired when the initial/autofilled value is compared with the item list. The event detail property contains an array with the matching list item(s). The array is empty when there is no match.
             </tr>
           </tbody>
         </table>
      </div>
    </div>
  </section>

  <section class="container" id="api"> 
    <h2>API</h2>
    <div class="row">
      <div class="col-sm-12">
         <h3>Functions</h3>
         <table>
           <thead>
             <tr>
               <th>Function name
               <th>Description
             </tr>
           </thead>
           <tbody>
             <tr>
               <td><code>ajax(url, urlEnd, val, fn, xhr)</code>
               <td>Default ajax method, available for convenience. It performs a GET request on url + val + urlEnd. fn is the callback method. xhr is optional, you can pass on a preconfigured XMLHttpRequest. 
             <tr>
               <td><code>convertInput(text)</code>
               <td>Default convertInput available for convenience. It trims spaces and converts text to lowercase.
             <tr>
               <td><code>item(html, input)</code>
               <td>Item function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility" target="awe">Awesomplete</a>) which create an 'li' element with the given html as innerHTML.
             <tr>
               <td><code>itemContains(html, input)</code>
               <td>Item function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility" target="awe">Awesomplete</a>) that highlights occurrences of the input text in the first line (until &lt;p&gt;). This function is used by default.
             <tr>
               <td><code>itemMarkAll(html, input)</code>
               <td>Item function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility" target="awe">Awesomplete</a>) that highlights all occurrences of the input text.
             <tr>
               <td><code>itemStartsWith(html, input)</code>
               <td>Item function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility" target="awe">Awesomplete</a>) that highlights the input text in the start text.
             <tr>
               <td><code>load(awe, list, queryValue)</code>
               <td>Load a new list. queryValue is the value that was used to retrieve the list. 
                    Set to null if for any change a re-query must be done. Set to true if the list contains all values (loadall).
             <tr>
               <td><code>mark(text, input, startsWith)</code>
               <td>returns text with HTML mark elements for matching input. It does not place markers in HTML tags. When startsWith is true it only marks matching begin text.
             <tr>
               <td><code>itemStartsWith(text, input)</code>
               <td>item function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility" target="awe">Awesomplete</a>) which highlights matching begin text.
             <tr>
               <td><code>update(awe, value, prepop)</code>
               <td>Update awesomplete input value via javascript. If you do this directly on the input control, no events will fire. If you use this update function, the AwesompleteUtil can check if the value exists in the suggestion list and set classes on the input control and fire it's events. Specify prepop=true if it is an initial value (no user input). Default value for prepop: false
             <tr>
               <td><code>start(elemId, utilOpts, opts)</code>
               <td>Create the Awesomplete object and attach event-handlers for AwesompleteUtil. elemId must be either a DOM element or a string with the query for document.querySelector to find the element. In general use '#id_of_element'. utilsOpts is an json object with the options for AwesompleteUtil, see the table below. opts are the options for Awesomplete and are passed on unchanged.
             <tr>
               <td><code>startCopy(sourceId, dataField, targetId, prepop)</code>
               <td>Listens to awesomplete-prepop (when prepop is not false) and awesomplete-match events from the source, and copy the dataField to the DOM element with the given target id. The targetId can also be a javascript function. This function receives two parameters: event and dataField. The event detail property contains an array with the matching list item. The array is empty when there is no match. Default value for prepop: true. dataField must be null if the list items are strings.
             <tr>
               <td><code>startClick(btnId, awe)</code>
               <td>Listen to click events of a button. Toggles open/close of the suggestion list.
             <tr>
               <td><code>filterContains(data, input)</code>
               <td>filter function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility" target="awe">Awesomplete</a>) to filter suggestions. input is searched in data.value. Notice that Awesomplete.FILTER_CONTAINS by default searches on data.label.
             <tr>
               <td><code>filterStartsWith(data, input)</code>
               <td>filter function (as specified in <a href="http://leaverou.github.io/awesomplete/index.html#extensibility">Awesomplete</a>) to filter suggestions. input is searched as start text in data.value. Notice that Awesomplete.FILTER_STARTWITH by default searches on data.label.
             <tr>
               <td><code>jsonFlatten(data)</code>
               <td>function to flatten JSON. Notice that you can supply extra options via jsonFlatten.bind(opts) where opts is a json objects with options 'root', 'value' and 'label'.
             </tr>
           </tbody>
         </table>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
         <h3>util options of the start function</h3>
         <table>
           <thead>
             <tr>
               <th>Option name
               <th>Description
             </tr>
           </thead>
           <tbody>
             <tr>
                <td>ajax 
                <td>Replace ajax function. Supplied function receives these parameters: (url, urlEnd, val, fn, xhr). fn is the callback function. Default: AwesompleteUtil.ajax. 
             <tr>
                <td>convertInput
                <td>Convert input function. Internally convert input for comparison with the data list items. By default it trims the input and converts it to lowercase for a case-insensitive comparison. 
             <tr>
                <td>convertResponse
                <td>Convert JSON response from ajax calls. This function is called with the parsed JSON, and allows conversion of the data before further processing. Default: nil - no conversion.
             <tr>
                <td>limit
                <td>number. If a limit is specified, and the number of items returned by the server is equal or more as this limit, the AwesompleteUtil code assumes that there are more results, so it will re-query if more characters are typed to get more refined results. The limit:1 tells that not more than 1 result is expected, so the json service doesnâ€™t have to return an array. With limit:0 it will always re-query if more characters are typed. Default: no limit 
             <tr>
                <td>loadall
                <td>true/false. true if the data list contains all items. The input value will not be used in ajax calls. Default: false 
             <tr>
                <td>prepop
                <td>true/false. If true do lookup initial/autofilled value and send awesomplete-prepop event. Default: false
             <tr>
                <td>url
                <td>url for ajax calls.
             <tr>
                <td>urlEnd
                <td>Addition at the end of the url of the ajax call, after the input value.
             </tr>
           </tbody>
         </table>
      </div>
    </div>
  </section>

  <section class="container" id="epilogue"> 
    <h2>Anything else that comes to mind</h2>
    <div class="row">
      <div class="col-sm-12">
        License: MIT
        <p>
        <a href="https://lea.verou.me/2015/02/awesomplete-2kb-autocomplete-with-zero-dependencies/" target="awe">Lea's blog about the creation of Awesomplete</a>
      </div>
    </div>
  </section>

  <script src="https://leaverou.github.io/awesomplete/prism/prism.js"></script>
</body>
