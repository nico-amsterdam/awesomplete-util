<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Phoenix Awesomplete form helper</title>
<link rel="stylesheet" href="https://leaverou.github.io/awesomplete/prism/prism.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
<link rel="stylesheet" href="css/awesomplete.css">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<script src="js/awesomplete-v2024.min.js"></script>
<script src="js/awesomplete-util.min.js"></script>
<script src="js/scroll.js"></script>
<script src="js/showhidetoggle.js"></script>
<style>
  body { line-height: 150%; 
         font-size: 18px;
         display: flex;
         flex-direction: column;
         height: 100vh }

  /* style navbar */
  nav { background-color: lightblue;
        min-height: 135px }
  ul.navbar-nav li .nav-link { padding: 0 1em }
    
  header, section { padding-top: 40px }
  @media screen and (min-width: 576px) { 
    main { overflow-y: scroll;
           -webkit-overflow-scrolling: touch;
           flex: 1 }
    nav { min-height: 40px }
  }

  /* style html and javascript code blocks */
  .language-javascript,
  .language-markup { margin-top: -4em !important }
  .language-label  { text-align: right;
                     font-weight: bold; 
                     margin: 1.6em 1em;
                     color: brown }
  .runtime { padding: 1em 1em 0 1em;
               font-size: smaller }

  /* hide/show runtime code */
  .slide-up, .slide-down {
    max-height: 0;            
    overflow-y: hidden;
    -webkit-transition: max-height 0.8s ease-in-out;
    -moz-transition: max-height 0.8s ease-in-out;
    -o-transition: max-height 0.8s ease-in-out;
    transition: max-height 0.8s ease-in-out
  }
  .slide-down {            
    max-height: 1000px;
  }

  /* fight with bootstrap */
  .table { display: table }
  h2 { margin-left:  -15px;
       margin-right: -15px }

  /* style awesomplete-util */
  div.awesomplete { display: block }
  .input-group-btn .dropdown-btn { line-height: 32px;
                                   border-color: lightgray }
  .input-group-btn { display: table-cell;
                     vertical-align: top }
  .table .awesomplete { display: table-cell;
                        vertical-align: top }
  div.awesomplete ul { font-size: smaller }
  div.awesomplete ul li p { display: block; 
                            font-size: small;
                            margin-left: 1em;
                            color: #000 }
  div.awesomplete .awe-found { border: 2px solid green }
  div.awesomplete .awe-not-found { border: 2px solid red }
  .hide-not-found div.awesomplete .awe-not-found { border-color: lightblue }

  /* style examples */
  .au   { margin-top: -6px }
  .hint { margin-bottom: 10px }
  .example { margin-top: 40px }
  #awe-track-artists ul { margin-top: 0 }
  .album { min-height: 200px }
  .odd  { border-right: thick ridge purple; 
          padding-right: 6px }
  .even { border-left: thick groove purple; 
          padding-left: 6px }
  .features { font-size: smaller;
              padding: 1em;
              margin-bottom: 2em;
              border: 3px solid blue }
  .html, .js, .heex, .extra-explain { margin-top: 1em }
  .caron {
	  border: 3px solid transparent;
	  pointer-events: none }

  /* For chips pills a.k.a. dismissible tags */
  .chip-container { min-height: 40px;
                    margin: 10px; }
  .chip { margin: 4px 25px 0 -9px;
          padding: 5px;
          background-color: lavender;
          display: inline-block;
        }
  .chip button { font-size: xx-small; 
          display: inline-block;
          margin-left: 5px;
          vertical-align: top;
          height: 26px;
          line-height: normal; 
        }
  .top-30px {
    margin-top: 30px;
  }

</style>
</head>
<body>
  <!-- Static navbar -->
  <nav class="navbar navbar-expand-sm navbar-light bg-faded">
    <a class="navbar-brand logo" href="#top">Phoenix Form Awesomplete</a>
    <div class="navbar-collapse justify-content-end">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#examples">Examples</a>
          <li class="nav-item"><a class="nav-link" href="https://hexdocs.pm/phoenix_form_awesomplete/PhoenixFormAwesomplete.html#module-installation" target="github">Installation</a>
          <li class="nav-item"><a class="nav-link" href="https://hexdocs.pm/phoenix_form_awesomplete/PhoenixFormAwesomplete.html" target="api">API</a>
        </ul>
    </div>
  </nav>
  <main>
    <header class="container" id="top">
      <div class="row">
        <div class="col-sm-12">
          <span class="logo">PhoenixFormAwesomplete</span> is a <a href="https://www.phoenixframework.org" target="phoe">Phoenix</a> form helper that utilizes Lea Verou's autocomplete / autosuggest / typeahead / inputsearch <a href="https://leaverou.github.io/awesomplete/index.html" target="awe">Awesomplete widget</a>. 
          <p>
          It comes with an <a href="index.html">AwesompleteUtil javascript library</a> which adds the following features:
          <ul>
            <li>Dynamic remote data loading; based on what is typed-in it performs an ajax lookup.
            <li>Allow HTML markup in the shown items. Show value with description. Optionally search in the description text.
            <li>Show when there is an exact match.
            <li>Show when there isn't a match.
            <li>When there is an exact match show related data (supplied in the remote data) in other parts of the page.
            <li>Select the highlighted item when the tab key is used.
          </ul>
        </div>
      </div>
    </header>

    <section class="container" id="examples">
      <h2>Examples</h2>

      <div class="row">
        <div class="col-sm-12 html">
           <ol>
              <li><a href="#github-username">Github username search</a>
              <li><a href="#itunes-artist">iTunes artist search</a>
              <li><a href="#itunes-track">iTunes track search</a>
              <li><a href="#combobox">Combobox with countries</a>
              <li><a href="#user-host">Connect as user to host</a>
              <li><a href="#iso-country">Country iso code</a>
              <li><a href="#colors">Colors</a>
              <li><a href="#capital">Country capitals</a>
              <li><a href="#seafood">Seafood pizza toppings</a>
              <li><a href="#multimail">Email address</a>
              <li><a href="#seafood2">Dismissible chip pills</a>
              <li><a href="#diacritics">Diacritics and ligatures</a>
              <li><a href="#mentions">Text with mentions</a>
           </ol>
        </div>
      </div>

    <!-- BEGIN Github username example -->
    <fieldset id="github-username" class="example">
      <legend class="h3">
      Github username search
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Dynamic data loading.
            <li>Show related data of selected item.
          </ul>
        </div>
        <div class="col-sm-12 hint">
          <p>Enter a username:
        </div>
        <label class="control-label text-sm-right col-sm-2" for="user_name1">Name</label>
        <div class="col-sm-10 au">
          <input id="user_name1" class="form-control" name="user[name1]" type="text">
        </div>
      </div>
      <div class="row odd avatar">
        <span class="control-label text-sm-right col-sm-2">Photo or avatar</span>
        <div class="col-sm-1" id="awe-avatar"></div>
        <img id="awe-avatar-img" alt="avatar image" width="100" height="100"
             src="https://www.gravatar.com/avatar/8833aef712168c3784ad9091214ba7d6?s=100&d=retro">
     </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 hint">
        Side note: the Github API will not show suggestions anymore if the API rate limit is exceeded for your IP address<span id="myipaddress"></span>.
      </div>
      <div class="col-sm-12 heex">
        The example above is made with the HEEx template below.
        <p>        
        The Github REST API also returns avatar url's. When there is an exact match, the avatar url will be set in the IMG tag to show the avatar picture.
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.simple_form
  for={@form}
  id="list-form"
  phx-target={@myself}
  phx-change="validate"
  phx-submit="save"
  &gt;
        
  &lt;div phx-update="ignore" id={"#{@form[:name1].id}-domspace"}&gt;

    &lt;.input field={@form[:name1]} type="text" phx-debounce="blur" /&gt;

    &lt;img id="awe-avatar-img" 
      alt="avatar image" 
      width="100"
      height="100"
      /&gt;

    &lt;.autocomplete
      forField={@form[:name1]}
      url="https://api.github.com/search/users?q="
      urlEnd=" in:login type:user&per_page=30"
      minChars="3"
      maxItems="10"
      limit="30"
      value="login"
      filter="filterStartsWith"
      item="itemStartsWith"
      /&gt;

    &lt;.copy_value_to_id
      field={@form[:name1]}
      dataField="avatar_url"
      target="#awe-avatar-img"
      /&gt;

  &lt;/div&gt;

&lt;/.simple_form&gt;</code></pre>
      <div class="extra-explain">
          In this first example the surrounding elements are shown in the HEEx template to clarify the context:
          <ul>
            <li>The input is placed in a simple_form and uses the @form assign.</li>
            <li>The div with phx-update="ignore" is needed in LiveView, because Awesomplete manipulates the DOM.</li>
          </ul>
      </div>
        The <code>maxItems</code> parameter indicates that maximum 10 suggestions must be shown in the dropdown.
        <p>The <code>per_page</code> parameter in the url tells the server to return maximum 30 suggestions per call.
        <p>The <code>limit</code> parameter informs the AwesompleteUtil component that normally 30 results can be expected. If there are less than 30 results, any additional characters in the search phrase won't need a new server call, because all the matching suggestions are already retrieved.
        <p>
        <p>The client-side suggestions <code>filter</code> must be made consistent with the search functionality of the REST API. In this case, the server will only return usernames that start with the entered text, and the client-side filter should work in the same way.
        <p>The <code>item</code> parameter is configured to highlight only matching text at the beginning of the suggestions, to clearly indicate why these suggestions are shown. 
        <p>
        <script>
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://httpbin.org/ip');
        xhr.onload = function() { 
          var address = JSON.parse(this.responseText).origin;
          Awesomplete.$('#myipaddress').textContent = ' (' +  address + ')'
        }
        xhr.send(); 
        </script>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-github');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-github">
        <p class="language-label">Runtime javascript
        <pre class="language-javascript"><code><script>
AwesompleteUtil.start('#user_name1', 
 {
  url: 'https://api.github.com/search/users?q=',
  urlEnd: ' in:login type:user&per_page=30',  
  limit: 30
 },
 {
  minChars: 3, 
  maxItems: 10,
  data: function(rec, input) { return rec['login']; },
  filter: AwesompleteUtil.filterStartsWith,
  item: AwesompleteUtil.itemStartsWith
 }
);

AwesompleteUtil.startCopy('#user_name1', 'avatar_url', '#awe-avatar-img');</script></code></pre>
      </div>
    </div>
    <!-- END github username example -->


    <!-- BEGIN itunes artist example -->
    <fieldset id="itunes-artist" class="example">
      <legend class="h3">
      iTunes artist search
      </legend>
      <div class="row even">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Dynamic data loading.
            <li>Word search filter.
            <li>Word text highlighter.
          </ul>
          Obviously we cannot load all artists known by iTunes in the browsers memory, so that's why we use here
          dynamic data loading. The search starts if 3 characters are entered.
        </div>
        <div class="col-sm-12 hint">
           Enter an artist name:
        </div>
        <label class="control-label col-sm-2" for="user_artist1">Artist</label>
        <div class="col-sm-10 au">
           <input class="form-control" id="user_artist1" name="user[artist1]" type="text">
        </div>
      </div>
    </fieldset>

    <div class="row even">
      <div class="col-sm-12 js">
        The standard supplied 'starts-with' and 'contains' filters don't exactly match with how iTunes searches.
        iTunes searches words, you can search for 'Michael Jackson' or 'Jackson Michael' and get the same results.
        Thats why a filter called 'filterWords' is used that filters on the words entered. To highlight the
        words in the list of suggestions a function called 'itemWords' is used.
      </div>
      <div class="col-sm-12 heex">
        A limit of -1 is specified to force it to requery if more characters are typed. 
        The service search for whole words, so when a part of the word is entered and doesn't result in any hits,
        this doesn't mean that there wouldn't be more results if more characters are typed.
        For example: search for 'jackso' results in 1 hit, but 'jackson' gives a lot more results.
        <p>
        The iTunes service doesn't support wildcards but others (like Elasticsearch) do. Assuming that the user
        is completing the last word while typing, you could add a * wildcard at the end of the search url with the
        <code> urlEnd: '*' </code> configuration to search the last word starting with the typed letters.
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:artist1]} type="text" phx-debounce="blur" /&gt;

&lt;.autocomplete
  forField={@form[:artist1]}          
  url="https://itunes.apple.com/search?entity=musicArtist&amp;attribute=artistTerm&amp;media=music&amp;limit=15&amp;country=gb&amp;sort=artistTerm&amp;term="
  limit="-1"
  debounce="300"
  filter="filterWords"
  item="itemWords"
  value="artistName"
  /&gt;</code
></pre>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-artist');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-artist">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_artist1',
 {  /* util options */
  url:    "https://itunes.apple.com/search?entity=musicArtist&attribute=artistTerm&media=music&limit=15&country=gb&sort=artistTerm&term=",
  limit:   -1,
  debounce: 300
 }, 
 {  /* awesomplete options */
  minChars: 3,
  filter: AwesompleteUtil.filterWords,
  item: AwesompleteUtil.itemWords,
  data: function(rec, input) { return rec['artistName']; }
 }
);</script></code></pre>
      </div>
    </div>
    <!-- END itunes artist example -->

    <!-- BEGIN itunes track example -->
    <fieldset id="itunes-track" class="example">
      <legend class="h3">
      iTunes track search
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Dynamic data loading.
            <li>Show related data of selected item.
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter a song title:
        </div>
        <label class="control-label text-sm-right col-sm-2" for="user_track1">Track</label>
        <div class="col-sm-10 au">
          <input id="user_track1" class="form-control" name="user[track1]" type="text">
        </div>
      </div>
      <div class="row odd artists">
         <span class="control-label text-sm-right col-sm-2">Artists</span>
         <div class="col-sm-10" id="awe-track-artists"></div>
      </div>
      <div class="row odd album"> 
         <span class="control-label text-sm-right col-sm-2">Album</span>
         <div class="col-sm-3" id="awe-track-album"></div>
         <img id="awe-track-album-img" alt="album image" width="200"
              src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=">
      </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 heex">
        The creation of the Awesomplete object below is almost the same as in the 'iTunes artist search' example.
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:track1]} type="text" phx-debounce="blur" /&gt;

&lt;.copy_value_to_id
  field={@form[:track1]}
  dataField="collectionName"
  target="#awe-track-album"
  /&gt;

&lt;.copy_value_to_id
  field={@form[:track1]}
  dataField="artistName"
  target="#awe-track-artist"
  /&gt;

&lt;.copy_value_to_id
  field={@form[:track1]}
  dataField="artworkUrl100"
  target="#awe-track-album-img"
  /&gt;

&lt;.autocomplete
  forField={@form[:track1]}
  url="https://itunes.apple.com/search?entity=song&amp;attribute=songTerm&amp;media=music&amp;limit=10&amp;country=gb&amp;sort=songTerm&amp;term="
  limit="-1"
  debounce="300"
  maxItems="10"
  minChars="4"
  value="trackName"
  descr="collectionName"
  filter="filterWords"
  item="itemWords"
  /&gt;</code></pre>
        Unfortunetly we cannot instruct to iTunes to sort on song title length.
        If you search for songs with only one or two words, it might be that the desired song is not in the first 
        10 shown results.
        <p class="runtime"><a href="#" onclick="return toggle('#awe-track');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-track">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>
AwesompleteUtil.startCopy('#user_track1', 'collectionName', '#awe-track-album');
AwesompleteUtil.startCopy('#user_track1', 'artistName',    '#awe-track-artists');
AwesompleteUtil.startCopy('#user_track1', 'artworkUrl100', '#awe-track-album-img');

AwesompleteUtil.start('#user_track1', 
 {
  url: 'https://itunes.apple.com/search?entity=song&attribute=songTerm&media=music&limit=10&country=gb&sort=songTerm&term=',
  limit: -1,
  debounce: 300
 },
 {
  minChars: 4, 
  data: function(rec, input) { 
         return { 
           label: rec['trackName']+'<p>'+(rec['collectionName'] || ''), 
           value: rec['trackName'] 
          }; 
        }, 
  filter: AwesompleteUtil.filterWords,
  item: AwesompleteUtil.itemWords
 }
);</script></code></pre>
      </div>
    </div>
    <!-- END itunes track example -->

    <!-- BEGIN combobox example -->
    <fieldset id="combobox" class="example">
      <legend class="h3">
      Combobox with countries
      </legend>
      <div class="row even">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Combobox.
            <li>Use remote service which returns everything; load all.
          </ul>
        </div>
        <div class="col-sm-12 hint">
        </div>
        <label class="control-label col-sm-2" for="user_combocountry">Country</label>
        <div class="col-sm-10 au">
           <span class="table">
              <input class="form-control" id="user_combocountry" name="user[combocountry]" type="text">
              <span class="input-group-btn">
                 <button class="dropdown-btn" id="awe_btn_user_combocountry" type="button" tabindex="-1">
                    <span class="caron">&#9660;</span>
                 </button>
              </span>
           </span>
        </div>
      </div>
    </fieldset>

    <div class="row even">
      <div class="col-sm-12 heex">
        The combobox is useful when there are only a few items in the list, 
        or to give the user some examples of expected input.
        Here we use maxItems:8, so when the combobox is opened, only the first 8 countries are shown.
        The shortest country names are shown first.
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:combocountry]} type="text" phx-debounce="blur" /&gt;

&lt;span class="input-group-btn"&gt;
  &lt;button class="dropdown-btn" id={"awe_btn_#{@form[:combocountry].id}"} type="button" tabindex="-1"&gt;
      &lt;span class="caron"&gt;&amp;#9660;&lt;/span&gt;
  &lt;/button&gt;
&lt;/span&gt;

&lt;.autocomplete
  forField={@form[:combocountry]}
  url="https://nico-amsterdam.github.io/awesomplete-util/json/countries.json"
  loadall="true"
  prepop="true"
  minChars="1"
  maxItems="8"
  value="name"
  combobox="true"
  /&gt;</code></pre>
        The prepop:true makes sure that the countries are loaded during page load.
        The combobox:true will open/close the list when the button is pushed, assuming the id of the button is 'awe_btn_' + id of input-text. Instead of true/false you can also supply the id of the button with the combobox property.
        <p class="runtime"><a href="#" onclick="return toggle('#awe-combobox');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-combobox">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startClick('#awe_btn_user_combocountry',
  AwesompleteUtil.start('#user_combocountry',
   {
    url: 'https://nico-amsterdam.github.io/awesomplete-util/json/countries.json',
    loadall: true, 
    prepop: true
   }, 
   {
    minChars: 1,
    maxItems: 8,
    data: function(rec, input) { return rec['name']; }
   }
  )
);</script></code></pre>
      </div>
    </div>
    <!-- END combobox example -->

    <!-- BEGIN user_host example -->
    <fieldset id="user-host" class="example">
      <legend class="h3">
      Connect as user to host
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Type user name and get suggestions for hostnames; autocomplete after a certain character.
            <li>Show descriptions in the suggestion list.
            <li>Load suggestions from static json file.
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter for example 'root@192.168.1.1'
        </div>
        <label class="control-label col-sm-2" for="user_host">User@host</label>
        <div class="col-sm-10 au hide-not-found">
           <input class="form-control" id="user_host" name="user[host]" type="text">
        </div>
      </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 js">
        Add a custom function to the custom awesomplete context in app.js:
        <p class="language-label">Javascript
        <pre class="language-markup"><code >customAwesompleteContext.dataAfterAtSign = function (data, input) { 
  var before = (input.slice(0, input.indexOf('@')) + '@').trim(); 
  return {label: before + data.label, value: before + data.value}; 
}</code></pre>
      </div>
      <div class="col-sm-12 heex">
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:host1]} type="text" phx-debounce="blur" /&gt;

&lt;.autocomplete
  forField={@form[:host1]}
  url="/js/host.json"
  loadall="true"
  filter="filterStartsWith"
  value="value"
  descr="label"
  data="dataAfterAtSign"
  /&gt;</code></pre>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-user-host');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-user-host">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_host',
 {
   url: 'js/host.json',
   loadall: true
 },
 {
   data: function(rec, input) {
     var data = { label: rec['value']+'<p>'+(rec['label'] || ''), value: rec['value'] }, 
       before = (input.slice(0, input.indexOf('@')) + '@').trim(); 
     return {label: before + data.label, value: before + data.value}; 
   },
   filter: AwesompleteUtil.filterStartsWith, 
   item: AwesompleteUtil.itemStartsWith
 }
);</script></code></pre>
      </div>
    </div>
    <!-- END user_host example -->

    <!-- BEGIN iso-country example -->
    <fieldset id="iso-country" class="example">
      <legend class="h3">
      Country iso code
      </legend>
      <div class="row even">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Use remote service that doesn't return a list but a single entry to verify input.
            <li>Handle HTTP 404 status with custom ajax function.
            <li>Show related data if entry found.
            <li>Flatten the json structure in the response.
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter for example 'usa'
        </div>
        <label class="control-label col-sm-2" for="user_country_iso">Country iso three letter code</label>
        <div class="col-sm-10 au">
            <input class="form-control" id="user_country_iso" name="user[country_iso]" type="text">
           <span id="awe-country-name"></span>
        </div>
      </div>
    </fieldset>

    <div class="row even">
      <div class="col-sm-12 js">
        The remote service returns a HTTP status 404/400 if the searched value is not found. The default ajax
        function only processes responses with HTTP OK status 200.
        The ajax404 function below replaces the onload function to set the empty list if a 404 is received. 
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>const ajax404  = function(url, urlEnd, val, fn, xhr) {
    var awe = this;
    function onload404() {
      if (xhr.status === 404 || xhr.status === 400) AwesompleteUtil.load(awe, [], val);
      fn();
    }
    AwesompleteUtil.ajax(url, urlEnd, val, onload404, xhr);
  };
</script>customAwesompleteContext.ajax404 = ajax404</code></pre>
      </div>
      <div class="col-sm-12 heex">
        This is actually not an autocomplete, but it does verify the input.
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:country_iso]} type="text" phx-debounce="blur" /&gt;

&lt;span id="awe-country-name"&gt;&lt;/span&gt;

&lt;.autocomplete
  forField={@form[:country_iso]}
  url="https://restcountries.com/v3/alpha/"
  value="cca3"
  limit="1"
  minChars="3"
  maxItems="0"
  filter="filterStartsWith"
  ajax="ajax404"
  convertResponse="jsonFlatten"
  /&gt;

&lt;.copy_value_to_id
  field={@form[:country_iso]}
  dataField="name.official"
  target="#awe-country-name"
  /&gt;</code></pre>
        A limit:1 tells that not more than 1 result is expected, so the json service doesn't have to return an array.
        <p>
        The official name is in JSON structure like this { "name": {"official": "the country name"}}. The jsonFlatten
        function transforms this to {"name.official": "the country name"}, which makes is easier to pick it up in the copy_to_value_id function.
        <p class="runtime"><a href="#" onclick="return toggle('#awe-country-iso');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-country-iso">

        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startCopy('#user_country_iso', 'name.official', '#awe-country-name');
AwesompleteUtil.start('#user_country_iso',
 {
  url: 'https://restcountries.com/v3/alpha/',
  limit: 0,
  ajax: ajax404,
  convertResponse: AwesompleteUtil.jsonFlatten
 }, 
 {
  maxItems: 0,
  minChars: 3,
  data: function(rec, input) { return rec['cca3']; },
  filter: AwesompleteUtil.filterStartsWith
 }
);</script></code></pre>
      </div>
    </div>
    <!-- END iso-country example -->

    <!-- BEGIN colors example -->
    <fieldset id="colors" class="example">
      <legend class="h3">
      Colors
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Suggestion list with value and label as part of page source.
            <li>Label with HTML markup.
            <li>Show related data of initial/autofill value; Prepopulation event during page load
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter a color:
        </div>
        <label class="control-label col-sm-2" for="user_color">Color</label>
        <div class="col-sm-10 au">
           <input id="user_color" class="form-control" name="user[color]" value="purple" type="text">
        </div>
        <div class="col-sm-2 text-sm-right"><span id="awe-color-result"></span> &#x21B2;</div>
      </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 js">
        Define the color list in app.js and add it to the custom awesomplete context:
        <p class="language-label">Javascript
        <pre class="language-markup"><code >
customAwesompleteContext.listColor = [
  { label: "&lt;b style='color:black'&gt;black&lt;/b&gt;",   value: 'black' },
  { label: "&lt;b style='color:blue'&gt;blue&lt;/b&gt;",     value: 'blue'  },
  { label: "&lt;b style='color:brown'&gt;brown&lt;/b&gt;",   value: 'brown' },
  { label: "&lt;b style='color:green'&gt;green&lt;/b&gt;",   value: 'green' },
  { label: "&lt;b style='color:orange'&gt;orange&lt;/b&gt;", value: 'orange'},
  { label: "&lt;b style='color:pink'&gt;pink&lt;/b&gt;",     value: 'pink'  },
  { label: "&lt;b style='color:purple'&gt;purple&lt;/b&gt;", value: 'purple'},
  { label: "&lt;b style='color:red'&gt;red&lt;/b&gt;",       value: 'red'   },
  { label: "&lt;b style='color:yellow'&gt;yellow&lt;/b&gt;", value: 'yellow'}
]
</code></pre>
      </div>
      <div class="col-sm-12 html">
        Input control:
        <p class="language-label">HEEx
        <pre class="language-markup"><code>&lt;.input field={@form[:color]} type="text" value="purple" phx-debounce="blur" /&gt;
&lt;div&gt;&lt;span id="awe-color-result"&gt;&lt;/span&gt; &amp;#x21B2;&lt;/div&gt;

&lt;.autocomplete
  forField={@form[:color]} 
  minChars="1" 
  prepop="true"
  filter="filterContains"
  list="listColor"
  /&gt;

&lt;.copy_value_to_id
  field={@form[:color]}
  dataField="label"
  target="#awe-color-result"
  /&gt;</code></pre>
      Notice the prepop property and the startCopy function call. The initial/autofilled value of input-control triggers the copy action, and the label is copied to the span-tag with id 'awe-color-result' during page load. The order of the HTML elements and the inline script is important here. The startCopy function must be called before the startAwesomplete function, because the latter can immediately fire the 'awesomplete-prepop' event which should be handled by the former.
The startCopy inline script should preferable be placed after the HTML element which is the target. If you do, it only has to lookup the target element once, but if you don't do this it will lookup the target element with each event.
<p>
If you use remote data loading and combine prepop:true with loadall:true the remote call will happen during page load. If prepop:false, the loadall will be done lazely, e.g. if the user makes changes and the input size >= minChars.
        <p class="runtime"><a href="#" onclick="return toggle('#awe-colors');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-colors">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startCopy('#user_color', 'label', '#awe-color-result');
AwesompleteUtil.start('#user_color', 
 {
  prepop: true
 }, 
 { 
  list: [
    { label: "<b style='color:black'>black</b>",   value: 'black' },
    { label: "<b style='color:blue'>blue</b>",     value: 'blue'  },
    { label: "<b style='color:brown'>brown</b>",   value: 'brown' },
    { label: "<b style='color:green'>green</b>",   value: 'green' },
    { label: "<b style='color:orange'>orange</b>", value: 'orange'},
    { label: "<b style='color:pink'>pink</b>",     value: 'pink'  },
    { label: "<b style='color:purple'>purple</b>", value: 'purple'},
    { label: "<b style='color:red'>red</b>",       value: 'red'   },
    { label: "<b style='color:yellow'>yellow</b>", value: 'yellow'}
  ], 
  minChars: 1, 
  filter: AwesompleteUtil.filterContains
 }
);</script></code></pre>
      </div>
    </div>
    <!-- END colors example -->

    <!-- BEGIN capital example -->
    <fieldset id="capital" class="example">
      <legend class="h3">
      Country capitals
      </legend>
      <div class="row even">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>One remote call (load all) resulting in one response list shared by multiple controls.
            <li>Copy related data of selected item to other input field, in two directions!
          </ul>
        </div>
        <div class="col-sm-12 hint">
            Enter either country or capital, and look what happens in the other field.
        </div>
        <label class="control-label col-sm-2" for="user_country">Country</label>
        <div class="col-sm-4 au">
           <input id="user_country" class="form-control" name="user[country]" type="text">
        </div>
        <label class="control-label col-sm-2" for="user_capital">Capital</label>
        <div class="col-sm-4 au">
           <input id="user_capital" class="form-control" name="user[capital]" type="text">
        </div>
      </div>
    </fieldset>

    <div class="row even">
      <div class="col-sm-12 js">
        Load the countries and capitals in app.js and add them to the custom awesomplete context:
        <p class="language-label">Javascript
        <pre class="language-markup"><code >
// use fetch function and json parser to retrieve countries
const countryResponse = await fetch("https://nico-amsterdam.github.io/awesomplete-util/json/countries.json")
customAwesompleteContext.listCountry = await countryResponse.json() 

// The filter below removes countries without capital.
customAwesompleteContext.listCapital = listCountry.filter(function(e) { return e.capital })</code></pre>
      </div>
      <div class="col-sm-12 heex">
        <p class="language-label">HEEx
        <pre class="language-markup"><code>&lt;.input field={@form[:country]} type="text" phx-debounce="blur" /&gt;
          
&lt;.input field={@form[:capital]} type="text" phx-debounce="blur" /&gt;

&lt;.autocomplete
  forField={@form[:country]} 
  assign="true"
  minChars="1" 
  maxItems="7" 
  value="name" 
  list="listCountry"
  /&gt;

&lt;.autocomplete
  forField={@form[:capital]} 
  assign="true"
  minChars="1" 
  maxItems="7" 
  value="capital" 
  list="listCapital"
  /&gt;

&lt;.copy_value_to_field
  sourceField={@form[:country]}
  dataField="capital"
  targetField={@form[:capital]}
  /&gt;

&lt;.copy_value_to_field
  sourceField={@form[:capital]}
  dataField="name"
  targetField={@form[:country]}
  /&gt;</code></pre>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-capital');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-capital">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.startCopy('#user_country', 'capital', '#user_capital');
AwesompleteUtil.startCopy('#user_capital', 'name', '#user_country');
var awe_user_country=AwesompleteUtil.start('#user_country', 
 {}, 
 {
  minChars: 1, 
  maxItems: 7, 
  data: function(rec, input) { return rec['name']; }
 }
);

var awe_user_capital=AwesompleteUtil.start('#user_capital', 
 {}, 
 {
  minChars: 1, 
  maxItems: 7, 
  data: function(rec, input) { return rec['capital']; }
 }
);</script></code></pre>
      </div>
      <script>AwesompleteUtil.ajax('https://nico-amsterdam.github.io/awesomplete-util/json/countries.json', '', '', 
  function(e) {
    var xhr = this, list;
    if (xhr.status === 200) {
      list = JSON.parse(xhr.responseText);
      AwesompleteUtil.load(awe_user_country, list, true);
      // The filter below removes countries without capital.
      AwesompleteUtil.load(awe_user_capital, list.filter(function(e) { return e.capital }), true);
    }
   }
);</script>
    </div>
    <!-- END capital example -->

    <!-- BEGIN seafood example -->
    <fieldset id="seafood" class="example">
      <legend class="h3">
      Seafood toppings
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Data list in page source.
            <li>Select multiple items.
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter for example 'Crayfish, Oysters'
        </div>
        <label class="control-label col-sm-2" for="user_seafood">Seafood toppings</label>
        <div class="col-sm-10 au">
           <input class="form-control" id="user_seafood" name="user[seafood]" type="text" data-list="#seafood_options">
            <datalist id="seafood_options">
	            <option>Anchovies</option>
	            <option>Cajun Prawn</option>
	            <option>Crayfish</option>
	            <option>Lobster</option>
	            <option>Oysters</option>
	            <option>Prawns</option>
	            <option>Salmon</option>
	            <option>Shrimps</option>
	            <option>Smoked Salmon</option>
	            <option>Squid</option>
	            <option>Tuna</option>
	            <option>Whitebait</option>
            </datalist>
        </div>
      </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 heex">
        Notice that you can enter multiple toppings, seperated by , or ;
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:seafood]} type="text" phx-debounce="blur" data-list="#seafood_options" /&gt;
&lt;datalist id="seafood_options"&gt;
   &lt;option&gt;Anchovies&lt;/option&gt;
   &lt;option&gt;Cajun Prawn&lt;/option&gt;
   &lt;option&gt;Crayfish&lt;/option&gt;
   &lt;option&gt;Lobster&lt;/option&gt;
   &lt;option&gt;Oysters&lt;/option&gt;
   &lt;option&gt;Prawns&lt;/option&gt;
   &lt;option&gt;Salmon&lt;/option&gt;
   &lt;option&gt;Shrimps&lt;/option&gt;
   &lt;option&gt;Smoked Salmon&lt;/option&gt;
   &lt;option&gt;Squid&lt;/option&gt;
   &lt;option&gt;Tuna&lt;/option&gt;
   &lt;option&gt;Whitebait&lt;/option&gt;
&lt;/datalist&gt;

&lt;.autocomplete
  forField={@form[:seafood]}
  minChars="1"
  multiple=",;"
  /&gt;</code></pre>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-seafood');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-seafood">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_seafood',
 {
  convertInput: function(input) { return input.replace(/[,;]\s*$/, '').match(/[^,;]*$/)[0].trim().toLowerCase(); }
 },
 {
  minChars: 1,
  replace: function(data) { 
    var text=data.value; 
    this.input.value = this.input.value.match(/^.+[,;]\s*|/)[0] + text + ', ';
  },
  filter: function(data, input) {
    return Awesomplete.FILTER_CONTAINS.call(this, data, input.match(/[^,;]*([,;]\s*)?$/)[0]);
  },
  item: function(text, input, item_id) {
    return AwesompleteUtil.itemContains.call(this, text, input.match(/[^,;]*([,;]\s*)?$/)[0], item_id); 
  }
 }
);</script></code></pre>
        The regular expressions are used to extract the last part of the input from the rest.
      </div>
    </div>
    <!-- END seafood example -->


    <!-- BEGIN multimail example -->
    <fieldset id="multimail" class="example">
      <legend class="h3">
      Email address
      </legend>
      <div class="row even">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>In the shown suggestions the email address is shown below the name. The value contains both.
            <li>Multiple input values.
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter an email address (they are all from starwars.com):
        </div>
        <label class="control-label col-sm-2" for="user_multimail">Email</label>
        <div class="col-sm-10 au">
           <input class="form-control" id="user_multimail" name="user[multimail]" type="text">
        </div>
      </div>
    </fieldset>

    <div class="row even">
      <div class="col-sm-12 js">
        This example uses Star Wars names from a github repository.
        The names2contacts function below constructs email addresses and a value that contains both name and email address.
        In app.js this function is added to the custom awesomplete context.
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>const names2contacts = function(names) {
  let email_result = {},
      result_list = [],
      transform_names = function(name) {
        let contact = {};
        contact.name = name;
        contact.email = name.toLowerCase().replace(' ', '.') + '@starwars.com';
        contact.value = contact.name + ' <' + contact.email + '>';
        result_list.push(contact);
      };
  names.forEach(transform_names);
  email_result.contacts = result_list;
  return email_result;
};
</script>customAwesompleteContext.names2contacts = names2contacts</code></pre>
      </div>
      <div class="col-sm-12 heex">
        Below the Awesomplete object and input control created 
        <p class="language-label">HEEx
        <pre class="language-markup"><code>&lt;.input field={@form[:multimail]} type="text" phx-debounce="blur" /&gt;

&lt;.autocomplete
  forField={@form[:multimail]}
  url="https://raw.githubusercontent.com/kentcdodds/starwars-names/main/src/starwars-names.json"
  convertResponse="names2contacts"
  loadall="true"
  minChars="1"
  maxItems="7"
  multiple=";,"
  value="value"
  label="name"
  descr="email"
  item="itemMarkAll"
  /&gt;</code></pre>
        In this example the 'value' field contains both name (label) and email address (descr).
        By default the description is not highlighted. The itemMarkAll function above
        highlights all matching text in the suggestion list, including the description.
        Try for example to search on '@starwars.com' to see what it highlights with or without this function. 
        <p class="runtime"><a href="#" onclick="return toggle('#awe-multimail');">show/hide runtime code</a>
        </div>
      <div class="col-sm-12 awe slide-up" id="awe-multimail">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_multimail',
 { 
  url: 'https://raw.githubusercontent.com/kentcdodds/starwars-names/main/src/starwars-names.json',
  convertResponse: names2contacts,
  loadall: true,
  convertInput: function(input) {
    return input.replace(/[;,]\s*$/, '').match(/[^;,]*$/)[0].trim().toLowerCase();
  }
 }, 
 {
  minChars: 1,
  maxItems: 7,
  data: function(rec, input) { 
    return { label: (rec['name'] || '').replace('<p>', '<p >')+'<p>'+(rec['email'] || ''),
             value: rec['value'] };
  }, 
  replace: function(data) { 
    var text=data.value; this.input.value = this.input.value.match(/^.+[;,]\s*|/)[0] + text + '; ';
  }, 
  filter: function(data, input) { 
    return Awesomplete.FILTER_CONTAINS.call(this, data.value, input.match(/[^;,]*([;,]\s*)?$/)[0]); 
  }, 
  item: function(text, input, item_id) { 
    return (AwesompleteUtil.itemMarkAll).call(this, text, input.match(/[^;,]*([;,]\s*)?$/)[0], item_id); 
  }
 }
);</script></code></pre>
      </div>
    </div>
    <!-- END multimail example -->

    <!-- BEGIN seafood with dismissible chip pills example -->
    <fieldset id="seafood2" class="example">
      <legend class="h3">
      Dismissible chip pills
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Data list in page source.
            <li>Dismissible chip pills, rendered via template.
          </ul>
        </div>
        <div class="col-sm-12 hint">
           Enter for example 'Oysters'
        </div>
        <label class="control-label col-sm-2 top-30px" for="user_seafood2">
          Seafood toppings</label>
        <div class="col-sm-10 au">
          <div id="seafood2-chip-container" class="chip-container" aria-live="polite"></div>
          <input class="form-control" id="user_seafood2" name="user[seafood2]" type="text" enterkeyhint="done"
            data-list="Anchovies, Cajun Prawn, Crayfish, Lobster, Oysters, Prawns, Salmon, Shrimps, Smoked Salmon, Squid, Tuna, Whitebait">
          <input id="user_seafood2_all" type="hidden" value="">
        </div>
      </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 heex">
        This example has a lot of custom code. The hidden input with id user_seafood2_all is used to 
        store the complete list. The visible input with id user_seafood2 is used to add new chip pills.
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;div id="seafood2-chip-container" class="chip-container" aria-live="polite"&gt;&lt;/div&gt;

&lt;.input field={@form[:seafood2]} type="text" phx-debounce="blur" enterkeyhint="done"
  data-list="Anchovies, Cajun Prawn, Crayfish, Lobster, Oysters, Prawns, Salmon, Shrimps, Smoked Salmon, Squid, Tuna, Whitebait" /&gt;

&lt;input type="hidden" id="user_seafood2_all" value="" /&gt;

&lt;.autocomplete
  forField={@form[:seafood2]}
  minChars="1"
  /&gt;</code></pre>
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>const SEP = ',',
      findById = (id, root) => (root || document).getElementById(id),
      splitAndTrim = (text) => text.split(SEP).map(item => item.trim()).filter(e => e !== ''),
      chipTemplate = (chip) => `<span class="chip">${chip}<button title="Remove ${chip} topping" aria-label="Remove ${chip} topping">&#10006;</button></span>`;

function removeFromList(text) {
  const elem = findById('user_seafood2_all'), // hidden input field
        newItems = splitAndTrim(text)
  elem.value = splitAndTrim(elem.value).filter(e => !newItems.includes(e)).join(SEP);
  return elem;
}

findById('seafood2-chip-container').addEventListener('click', function(el) {
  // This click-handler needs to know the HTML structure
  // (see chipTemplate) to identify the chip that must be removed.
  // Currently el.target is the button inside the span's with the chip text.
  const spanNode = el.target.parentNode; 
  if (spanNode.nodeName === 'SPAN') {
    // get text from span but exclude text from nested html elements.
    const spanTextWithoutButtonText = [].reduce.call(spanNode.childNodes, 
            (a, b) => { return a + (b.nodeType === 3 ? b.textContent : ''); }, '');
    spanNode.remove();
    removeFromList(spanTextWithoutButtonText.trim());
  }
});

function updateChips() {
   const all = findById('user_seafood2_all').value, 
         allArray = splitAndTrim(all);
   let chipButtons = '';
   for (const item in allArray) {
      const currentChipText = allArray[item]
      if (currentChipText) { 
          chipButtons += chipTemplate(currentChipText);
      }
   }
   findById('seafood2-chip-container').innerHTML = chipButtons;
}

// init: show the chips when you open the form and user_seafood2_all already has a value
updateChips();

function updateChipsAndclearInput(el) {
  const newItem = el.target.value.trim(); 
  if (newItem !== '') {
    const elem = removeFromList(newItem), // Remove it, if it is already in the list.
          normalizedValue = splitAndTrim(elem.value + SEP + newItem).join(',');
    elem.value = normalizedValue;
    el.target.value = '';
    Awesomplete.$.fire(el.target, 'input', {});
    updateChips();
  }
}
const inputElement = findById('user_seafood2');

// remove this listener to force user to select only from the suggestions list.
inputElement.addEventListener('keypress', function (el) {
    if (el.key === 'Enter') {
      updateChipsAndclearInput(el);
    }
});

// add chip and clear the input field for new chips.
inputElement.addEventListener('awesomplete-selectcomplete', updateChipsAndclearInput);

</script></code></pre>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-seafood2');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-seafood2">
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_seafood2',
 {
 },
 {
  minChars: 1 
 }
);
</script></code></pre>
        After every selection, the chip is added and the input field is cleared for the topping.
        The complete list is stored in an input element with type hidden.
      </div>
    </div>
    <!-- END seafood with dismissible chip pills example -->

    <!-- BEGIN diacritics example -->
    <fieldset id="diacritics" class="example">
      <legend class="h3">
      Diacritics and ligatures
      </legend>
      <div class="row even">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Type base characters and get suggustions with diacritics and ligatures
            <li>Using a custom filter
          </ul>
        </div>
        <div class="col-sm-12 hint">
          This example allows you to search for words with diacritics by typing just the base characters.
          For example search for 'oss' and besides 'fossilien' you will get the suggestion of 'größe'.
          <ul>
            <li>o is base character of ö
            <li>The ligature ß can be searched with 'ss'
          </ul>
        </div>
        <label class="control-label col-sm-2" for="user_diacritics">Search</label>
        <div class="col-sm-10 au">
            <input class="form-control" id="user_diacritics" name="user[diacritics]" type="text"
              data-list="ænigma, Æthel, böse, fließen, fossilien, fröhlich, führen, füllen, gänse, götter, größe, hände, hölle, hügel, küssen, kräftig, lösen, löwe, mädchen, männer, mächtig, müde, möglichkeit, Œdipus, œuvre, Osnabrück, rätseln, rösten, rühren, säen, säubern, schön, schwül, STRAUß, süß, träumen, überlegen, übermäßig, vögel, wählen, wände, Ĳmuiden, zählen, accès, appétit, cliché, déjà vu, garçon, hôtel, île, maître, pâté, où, quête, tête-à-tête, voilà">
        </div>
      </div>
    </fieldset>

    <div class="row even">
      <div class="col-sm-12 js">
        The functions below are used to convert diacrites and ligatures to base characters.
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>
function removeDiacritesAndLigature(text) {
  return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replaceAll('æ', 'ae').replaceAll('œ', 'oe').replaceAll('ß', 'ss').replaceAll('ĳ', 'ij');
}

function trimLowerDiacrites(input) {
  return removeDiacritesAndLigature(input.trim().toLowerCase());
}</script></code></pre>
      </div>
    </div>

    <div class="row even">
      <div class="col-sm-12 js">
        The custom awesomplete context has a custom diacritics filter:
        <p class="language-label">Javascript
        <pre class="language-markup"><code >

// This filter converts diacritics and ligatures to base characters and compares the converted strings.
customAwesompleteContext.filterDiacrites = function(text, input) {
  return trimLowerDiacrites(text).indexOf(trimLowerDiacrites(input)) !== -1;
}</code></pre>
          This example uses a fixed list of words. If you use a backend service to get suggestions,
          this backend service must apply the same search algorithm as this filter.  
      </div>  
    </div>
    <div class="row even">
      <div class="col-sm-12 heex">
        Input control:
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:diacritics]} type="text" phx-debounce="blur" 
    data-list="ænigma, Æthel, böse, fließen, fossilien, fröhlich
    , führen, füllen, gänse, götter, größe, hände, hölle, hügel
    , küssen, kräftig, lösen, löwe, mädchen, männer, mächtig
    , müde, möglichkeit, Œdipus, œuvre, Osnabrück, rätseln
    , rösten, rühren, säen, säubern, schön, schwül, STRAUß
    , süß, träumen, überlegen, übermäßig, vögel, wählen, wände
    , Ĳmuiden, zählen, accès, appétit, cliché, déjà vu, garçon
    , hôtel, île, accès, maître, pâté, où, quête, tête-à-tête
    , voilà" /&gt;
            
&lt;.autocomplete
  forField={@form[:diacritics]}
  minChars="1"
  maxItems="10"
  filter="filterDiacrites"
  /&gt;</code></pre>
          <p class="runtime"><a href="#" onclick="return toggle('#awe-diacritics');">show/hide runtime code</a>
        </div>
        <div class="col-sm-12 awe slide-up" id="awe-diacritics">
          <p class="language-label">Runtime javascript
          <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_diacritics',
  { 
  }, 
  {
    minChars: 1,
    maxItems: 10,
    filter: function(text, input) {
      return trimLowerDiacrites(text).indexOf(trimLowerDiacrites(input)) !== -1;
    }
  }
);</script></code></pre>
      </div>
    </div>
    <!-- END diacritics example -->

    <!-- BEGIN mentions example -->
    <fieldset id="mentions" class="example">
      <legend class="h3">
      Text with mentions
      </legend>
      <div class="row odd">
        <div class="col-xs-11 col-xs-offset-1 features">
          Example demonstrates:
          <ul>
            <li>Autocomplete after typing symbol (in this case: @)
            <li>Suggestions in the middle of the text, at the cursor position.
            <li>Autocomplete in a textarea
            <li>Custom input converter
            <li>Custom replace function
            <li>Custom search filter
            <li>Custom item highlighter
            <li>Option label used as description
            <li>Mixture of suggestions with and without extra description
          </ul>
        </div>
        <datalist id="peoplelist">
          <option>Ada</option>
          <option>Beyonce</option>
          <option>Chris</option>
          <option label="HR">Danny</option>
          <option>Edward</option>
          <option label="CEO">Frank</option>
          <option>Gerard</option>
          <option>Hanna</option>
          <option>Iris</option>
          <option>John</option>
          <option label="Director">Kate</option>
          <option label="Marketing">Leo</option>
          <option label="Sales">Max</option>
          <option label="IT">Neo</option>
          <option>Olivia</option>
          <option label="Finance">Penny</option>
          <option>Quincey</option>
          <option>Ryan</option>
          <option>Sarah</option>
          <option>Tara</option>
          <option>Umar</option>
          <option label="PR">Veronica</option>
          <option>Wendy</option>
          <option>Xena</option>
          <option>Yasmine</option>
          <option>Zara</option>
        </datalist>

        <div class="col-sm-12 hint">
           Enter for example: 'Maybe @Neo can solve this. I wil notify @Frank about this.'<p>Note that you can change the names @Neo and @Frank afterwards with autocompletion.
        </div>
        <label class="control-label text-sm-right col-sm-2" for="user_mentions">
          Comment</label>
        <div class="col-sm-10 au">
          <textarea class="form-control" id="user_mentions" name="user[mentions]" rows="2"
            data-list="#peoplelist"></textarea>
        </div>
      </div>
    </fieldset>

    <div class="row odd">
      <div class="col-sm-12 heex">
        This is an advanced example
        <p class="language-label">HEEx
        <pre class="language-markup"><code >&lt;.input field={@form[:mentions]} type="textarea" rows="2" phx-debounce="blur"
  data-list="#peoplelist" /&gt;

&lt;datalist id="peoplelist"&gt;
  &lt;option&gt;Ada&lt;/option&gt;
  &lt;option&gt;Beyonce&lt;/option&gt;
  &lt;option&gt;Chris&lt;/option&gt;
  &lt;option label="HR"&gt;Danny&lt;/option&gt;
  &lt;option&gt;Edward&lt;/option&gt;
  &lt;option label="CEO"&gt;Frank&lt;/option&gt;
  &lt;option&gt;Gerard&lt;/option&gt;
  &lt;option&gt;Hanna&lt;/option&gt;
  &lt;option&gt;Iris&lt;/option&gt;
  &lt;option&gt;John&lt;/option&gt;
  &lt;option label="Director"&gt;Kate&lt;/option&gt;
  &lt;option label="Marketing"&gt;Leo&lt;/option&gt;
  &lt;option label="Sales"&gt;Max&lt;/option&gt;
  &lt;option label="IT"&gt;Neo&lt;/option&gt;
  &lt;option&gt;Olivia&lt;/option&gt;
  &lt;option label="Finance"&gt;Penny&lt;/option&gt;
  &lt;option&gt;Quincey&lt;/option&gt;
  &lt;option&gt;Ryan&lt;/option&gt;
  &lt;option&gt;Sarah&lt;/option&gt;
  &lt;option&gt;Tara&lt;/option&gt;
  &lt;option&gt;Umar&lt;/option&gt;
  &lt;option label="PR"&gt;Veronica&lt;/option&gt;
  &lt;option&gt;Wendy&lt;/option&gt;
  &lt;option&gt;Xena&lt;/option&gt;
  &lt;option&gt;Yasmine&lt;/option&gt;
  &lt;option&gt;Zara&lt;/option&gt;
&lt;/datalist&gt;

&lt;.autocomplete
  forField={@form[:mentions]}
  minChars="1"
  convertInput="convertTextWithMentions"
  data="dataOptionalLabel"
  filter="filterTextWithMentions"
  item="itemTextWithMentions"
  replace="replaceTextWithMentions"
  /&gt;</code></pre>
        <p class="language-label">Javascript
        <pre class="language-javascript"><code><script>
var mentionEndCutPosition = function(textWithMentions) {
  const cursorPos = this.input.selectionStart, 
        match = textWithMentions.substr(cursorPos).match(/[\t \n@/]/), 
        cutPos = match ? match.index + cursorPos : textWithMentions.length;
  return cutPos;
},  
convertTextWithMentions = function(textWithMentions, cutTillSpace = true) {
  // Do not mark it green/red if there is nothing to look for
  if (!this.input.value.match(/@\S/)) return '';  
  let singleMentionAtCursor = textWithMentions;
  // if it is the suggestion text and not the user input 
  if (!textWithMentions.includes('@')) { 
    // the space character is also a delimiter, not handy to have in the suggestion list. 
    // Replace with no-break space. In de regex's below match whitespaces but not the no-break space. 
    singleMentionAtCursor = singleMentionAtCursor.replaceAll(' ', '\xA0'); 
  } else {
    // extract from cursor position till space or other @ or the end of the string
    const cutPos = mentionEndCutPosition.call(this, textWithMentions);
    singleMentionAtCursor = textWithMentions.substr(0, cutPos);
    // remove the @+spaces+chars entries from the end to ignore them in the compare between input and suggestion
    if (cutTillSpace) singleMentionAtCursor = singleMentionAtCursor.replace(/(@([\t \n]?|[\t \n][^@]*))+$/, ''); 
    // return when there is nothing to look for
    if (!singleMentionAtCursor.includes('@')) return '';
    // Get the string after the @ sign
    singleMentionAtCursor = singleMentionAtCursor.match(/[^@]*$/)[0];
    if (cutTillSpace) {
      // After the @ there is a word. Remove the text after the word.
      singleMentionAtCursor = singleMentionAtCursor.replace(/[\t \n][^@]*$/, ''); 
    } else if (singleMentionAtCursor.match(/^[\t \n]/)) {
      // filters by default ignore leading spaces, but in this case @+space should not match anything.
      return '';
    }  
  }
  // search/compare everything in lowercase
  return singleMentionAtCursor.toLowerCase();;
},
replaceTextWithMentions = function(data) { 
  // the space character is also a delimiter, not handy to have in the suggestion list. 
  // Replace with no-break space.
  const suggestionText   = data.value.replaceAll(' ', '\xA0'),
        textWithMentions = this.input.value; 
  if (!textWithMentions.includes('@')) { 
      // is a suggestion text, not user input
      this.input.value = suggestionText; 
      return; 
  }
  // extract from cursor position till space or other @ or the end of the string      
  const cutPos = mentionEndCutPosition.call(this, textWithMentions),
        afterText = textWithMentions.substr(cutPos),
        singleMentionAtCursor = textWithMentions.substr(0, cutPos),
        cutoffText = singleMentionAtCursor.substr(0, singleMentionAtCursor.lastIndexOf('@') + 1);

  this.input.value = cutoffText + suggestionText + (afterText === '' ? ' ' : afterText);
  // set cursor position at the end of the inserted suggestion text.
  this.input.selectionStart = this.input.selectionEnd = cutoffText.length + suggestionText.length + (afterText === '' ? 1 : 0);
},
filterTextWithMentions = function(data, input) {
  if (!input.includes('@')) return false;
  const conv = convertTextWithMentions.call(this, input, false)
  if (conv === '') return false;
  return Awesomplete.FILTER_CONTAINS.call(this, data.value, conv.replace('\xA0', ' '));
},
itemTextWithMentions = function(text, input, item_id) {
  return AwesompleteUtil.itemContains.call(this, text, input.match(/[^@]*(@[\t \n]*)?$/)[0], item_id); 
},
dataOptionalLabel = function(rec, input) {
  // peoplelist contains options     
  const val = rec['value'], lbl = rec['label'] || ''; 
  return { 
    // some options have labels, others not
    label: val + (val !== lbl ? '<p>' + lbl : ''), 
    value: val 
  }; 
};
</script>customAwesompleteContext.convertTextWithMentions = convertTextWithMentions;
customAwesompleteContext.replaceTextWithMentions = replaceTextWithMentions;
customAwesompleteContext.filterTextWithMentions = filterTextWithMentions;
customAwesompleteContext.itemTextWithMentions = itemTextWithMentions;
customAwesompleteContext.dataOptionalLabel = dataOptionalLabel;</code></pre>
        <p class="runtime"><a href="#" onclick="return toggle('#awe-mentions');">show/hide runtime code</a>
      </div>
      <div class="col-sm-12 awe slide-up" id="awe-mentions">     
        <p class="language-label">runtime javascript
        <pre class="language-javascript"><code><script>AwesompleteUtil.start('#user_mentions',
   {
    convertInput: convertTextWithMentions
   },
   {
    minChars: 1, 
    replace: replaceTextWithMentions,
    filter: filterTextWithMentions,
    item: itemTextWithMentions,
    data: dataOptionalLabel
  });</script></code></pre>
      </div>
    </div>
    <!-- END mentions example -->

    </section>

    <section class="container" id="other"> 
      <h2>Links</h2>
      <div class="row">
        <div class="col-sm-12">
           <p><a href="https://github.com/nico-amsterdam/phoenix_form_awesomplete/#installation" target="github">Installation</a>
           <p><a href="https://hexdocs.pm/phoenix_form_awesomplete/" target="api">API</a>
           <p>License: MIT
        </div>
      </div>
    </section>

    <script src="https://leaverou.github.io/awesomplete/prism/prism.js"></script>
  </main>
</body>
